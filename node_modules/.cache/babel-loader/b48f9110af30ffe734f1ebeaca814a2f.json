{"ast":null,"code":"import _slicedToArray from\"/Users/vivekchowdary/My_World/Authentication/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";var logoutTimer;var AuthContext=/*#__PURE__*/React.createContext({token:\"\",isLoggedIn:false,login:function login(token){},logout:function logout(){}});var calculateRemainingTime=function calculateRemainingTime(expirationTime){var currentTime=new Date().getTime();var adjExpirationTime=new Date(expirationTime).getTime();var remainingDuration=adjExpirationTime-currentTime;return remainingDuration;};var retriveStoredToken=function retriveStoredToken(){var storedToken=localStorage.getItem(\"token\");var storedExpirationDate=localStorage.getItem(\"expirationTime\");var remainingTime=calculateRemainingTime(storedExpirationDate);if(remainingTime<=60000){localStorage.removeItem(\"token\");localStorage.removeItem(\"expirationTime\");return null;}return{token:storedToken,duration:remainingTime};};export var AuthContextProvider=function AuthContextProvider(props){var tokenData=retriveStoredToken();var initialToken;if(tokenData){initialToken=tokenData.token;}var _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var isUserLoggedIn=!!token;var logoutHandler=useCallback(function(){setToken(null);localStorage.removeItem(\"token\");localStorage.removeItem('expirationTime');if(logoutTimer){clearTimeout(logoutTimer);}},[]);var loginHandler=function loginHandler(token,expirationTime){setToken(token);localStorage.setItem(\"token\",token);localStorage.setItem(\"expirationTime\",expirationTime);var remainingTime=calculateRemainingTime(expirationTime);logoutTimer=setTimeout(logoutHandler,remainingTime);};useEffect(function(){if(tokenData){logoutTimer=setTimeout(logoutHandler,tokenData.duration);}},[tokenData,logoutHandler]);var contextValue={token:token,isLoggedIn:isUserLoggedIn,login:loginHandler,logout:logoutHandler};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:props.children});};export default AuthContext;","map":{"version":3,"sources":["/Users/vivekchowdary/My_World/Authentication/src/store/auth-context.js"],"names":["React","useState","useEffect","useCallback","logoutTimer","AuthContext","createContext","token","isLoggedIn","login","logout","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retriveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","isUserLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","contextValue","children"],"mappings":"mKAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,WAArC,KAAwD,OAAxD,C,2CAEA,GAAIC,CAAAA,WAAJ,CAEA,GAAMC,CAAAA,WAAW,cAAGL,KAAK,CAACM,aAAN,CAAoB,CACtCC,KAAK,CAAE,EAD+B,CAEtCC,UAAU,CAAE,KAF0B,CAGtCC,KAAK,CAAE,eAACF,KAAD,CAAW,CAAE,CAHkB,CAItCG,MAAM,CAAE,iBAAM,CAAE,CAJsB,CAApB,CAApB,CAOA,GAAMC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,cAAD,CAAoB,CACjD,GAAMC,CAAAA,WAAW,CAAG,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAApB,CACA,GAAMC,CAAAA,iBAAiB,CAAG,GAAIF,CAAAA,IAAJ,CAASF,cAAT,EAAyBG,OAAzB,EAA1B,CAEA,GAAME,CAAAA,iBAAiB,CAAGD,iBAAiB,CAAGH,WAA9C,CAEA,MAAOI,CAAAA,iBAAP,CACD,CAPD,CASA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CAC/B,GAAMC,CAAAA,WAAW,CAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAApB,CACA,GAAMC,CAAAA,oBAAoB,CAAGF,YAAY,CAACC,OAAb,CAAqB,gBAArB,CAA7B,CAEA,GAAME,CAAAA,aAAa,CAAGZ,sBAAsB,CAACW,oBAAD,CAA5C,CAEA,GAAIC,aAAa,EAAI,KAArB,CAA4B,CAC1BH,YAAY,CAACI,UAAb,CAAwB,OAAxB,EACAJ,YAAY,CAACI,UAAb,CAAwB,gBAAxB,EACA,MAAO,KAAP,CACD,CAED,MAAO,CACLjB,KAAK,CAAEY,WADF,CAELM,QAAQ,CAAEF,aAFL,CAAP,CAID,CAhBD,CAkBA,MAAO,IAAMG,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACC,KAAD,CAAW,CAC5C,GAAMC,CAAAA,SAAS,CAAGV,kBAAkB,EAApC,CACA,GAAIW,CAAAA,YAAJ,CAEA,GAAID,SAAJ,CAAe,CACbC,YAAY,CAAGD,SAAS,CAACrB,KAAzB,CACD,CAED,cAA0BN,QAAQ,CAAC4B,YAAD,CAAlC,wCAAOtB,KAAP,eAAcuB,QAAd,eAEA,GAAMC,CAAAA,cAAc,CAAG,CAAC,CAACxB,KAAzB,CAEA,GAAMyB,CAAAA,aAAa,CAAG7B,WAAW,CAAC,UAAM,CACtC2B,QAAQ,CAAC,IAAD,CAAR,CACAV,YAAY,CAACI,UAAb,CAAwB,OAAxB,EACAJ,YAAY,CAACI,UAAb,CAAwB,gBAAxB,EAEA,GAAIpB,WAAJ,CAAiB,CACf6B,YAAY,CAAC7B,WAAD,CAAZ,CACD,CACF,CARgC,CAQ9B,EAR8B,CAAjC,CAUA,GAAM8B,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAC3B,KAAD,CAAQK,cAAR,CAA2B,CAC9CkB,QAAQ,CAACvB,KAAD,CAAR,CACAa,YAAY,CAACe,OAAb,CAAqB,OAArB,CAA8B5B,KAA9B,EACAa,YAAY,CAACe,OAAb,CAAqB,gBAArB,CAAuCvB,cAAvC,EAEA,GAAMW,CAAAA,aAAa,CAAGZ,sBAAsB,CAACC,cAAD,CAA5C,CAEAR,WAAW,CAAGgC,UAAU,CAACJ,aAAD,CAAgBT,aAAhB,CAAxB,CACD,CARD,CAUArB,SAAS,CAAC,UAAM,CACd,GAAI0B,SAAJ,CAAe,CACbxB,WAAW,CAAGgC,UAAU,CAACJ,aAAD,CAAgBJ,SAAS,CAACH,QAA1B,CAAxB,CACD,CACF,CAJQ,CAIN,CAACG,SAAD,CAAYI,aAAZ,CAJM,CAAT,CAMA,GAAMK,CAAAA,YAAY,CAAG,CACnB9B,KAAK,CAAEA,KADY,CAEnBC,UAAU,CAAEuB,cAFO,CAGnBtB,KAAK,CAAEyB,YAHY,CAInBxB,MAAM,CAAEsB,aAJW,CAArB,CAOA,mBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAEK,YAA7B,UACGV,KAAK,CAACW,QADT,EADF,CAKD,CAlDM,CAoDP,cAAejC,CAAAA,WAAf","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\n\nlet logoutTimer;\n\nconst AuthContext = React.createContext({\n  token: \"\",\n  isLoggedIn: false,\n  login: (token) => {},\n  logout: () => {},\n});\n\nconst calculateRemainingTime = (expirationTime) => {\n  const currentTime = new Date().getTime();\n  const adjExpirationTime = new Date(expirationTime).getTime();\n\n  const remainingDuration = adjExpirationTime - currentTime;\n\n  return remainingDuration;\n};\n\nconst retriveStoredToken = () => {\n  const storedToken = localStorage.getItem(\"token\");\n  const storedExpirationDate = localStorage.getItem(\"expirationTime\");\n\n  const remainingTime = calculateRemainingTime(storedExpirationDate);\n\n  if (remainingTime <= 60000) {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"expirationTime\");\n    return null;\n  }\n\n  return {\n    token: storedToken,\n    duration: remainingTime,\n  };\n};\n\nexport const AuthContextProvider = (props) => {\n  const tokenData = retriveStoredToken();\n  let initialToken;\n\n  if (tokenData) {\n    initialToken = tokenData.token;\n  }\n\n  const [token, setToken] = useState(initialToken);\n\n  const isUserLoggedIn = !!token;\n\n  const logoutHandler = useCallback(() => {\n    setToken(null);\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem('expirationTime');\n\n    if (logoutTimer) {\n      clearTimeout(logoutTimer);\n    }\n  }, []);\n\n  const loginHandler = (token, expirationTime) => {\n    setToken(token);\n    localStorage.setItem(\"token\", token);\n    localStorage.setItem(\"expirationTime\", expirationTime);\n\n    const remainingTime = calculateRemainingTime(expirationTime);\n\n    logoutTimer = setTimeout(logoutHandler, remainingTime);\n  };\n\n  useEffect(() => {\n    if (tokenData) {\n      logoutTimer = setTimeout(logoutHandler, tokenData.duration);\n    }\n  }, [tokenData, logoutHandler]);\n\n  const contextValue = {\n    token: token,\n    isLoggedIn: isUserLoggedIn,\n    login: loginHandler,\n    logout: logoutHandler,\n  };\n\n  return (\n    <AuthContext.Provider value={contextValue}>\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"]},"metadata":{},"sourceType":"module"}